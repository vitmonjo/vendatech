<div class="products-container fade-in">
  <mat-card class="filters-card">
    <form class="filters-form" (ngSubmit)="onSearch()">
      <mat-form-field appearance="outline" class="filter-field">
        <mat-label>Buscar produtos</mat-label>
        <input
          matInput
          [(ngModel)]="searchTerm"
          name="search"
          placeholder="Digite o nome do produto..."
          (keyup.enter)="onSearch()"
        />
        <button
          mat-icon-button
          color="primary"
          matSuffix
          type="button"
          (click)="onSearch()"
          aria-label="Buscar produto"
          [disabled]="isLoading"
        >
          <mat-icon>search</mat-icon>
        </button>
      </mat-form-field>

      <mat-form-field appearance="outline" class="filter-field">
        <mat-label>Categoria</mat-label>
        <mat-select
          [(ngModel)]="selectedCategory"
          name="category"
          (selectionChange)="onCategoryChange()"
          [disabled]="isLoading"
        >
          <mat-option *ngFor="let category of categories" [value]="category.value">
            {{ category.label }}
          </mat-option>
        </mat-select>
      </mat-form-field>

      <div class="filter-actions">
        <button
          mat-raised-button
          class="clear-filters-btn"
          type="button"
          (click)="clearFilters()"
          [disabled]="isLoading"
        >
          <mat-icon>clear</mat-icon>
          Limpar Filtros
        </button>
      </div>
    </form>
  </mat-card>

  <div *ngIf="isLoading" class="loading-shade">
    <mat-spinner diameter="50"></mat-spinner>
    <p>Carregando produtos...</p>
  </div>

  <div *ngIf="!isLoading && filteredProducts.length === 0" class="empty-state">
    <mat-icon>inventory_2</mat-icon>
    <h3>Nenhum produto encontrado</h3>
    <p>Tente ajustar os filtros de busca ou categoria.</p>
  </div>

  <div *ngIf="!isLoading && paginatedProducts.length > 0" class="products-grid">
    <mat-card *ngFor="let product of paginatedProducts" class="product-card">
      <div class="product-image-container">
        <img [src]="product.image" [alt]="product.name" class="product-image" />
      </div>

      <mat-card-content>
        <div class="product-row">
          <span class="product-name">{{ product.name }}</span>
          <span class="product-tag category-tag" aria-label="Categoria do produto">
            {{ product.category | titlecase }}
          </span>
        </div>

        <div class="product-row">
          <span class="price" aria-label="Preço do produto">
            {{ product.price | brazilianCurrency }}
          </span>
          <span
            *ngIf="product.stock > 0"
            class="product-tag stock-tag in-stock"
            aria-label="Status do estoque"
          >
            Em estoque
          </span>
          <span
            *ngIf="product.stock === 0"
            class="product-tag stock-tag out-of-stock"
            aria-label="Status do estoque"
          >
            Sem estoque
          </span>
        </div>

        <p class="product-description">
          {{ product.description | slice : 0 : 100
          }}{{ product.description.length > 100 ? '...' : '' }}
        </p>

        <div class="product-stock">
          <mat-icon>inventory</mat-icon>
          <span>{{ product.stock }} unidades disponíveis</span>
        </div>
      </mat-card-content>

      <mat-card-actions>
        <button mat-button class="details-button" [routerLink]="['/products', product._id]">
          <mat-icon>visibility</mat-icon>
          Ver Detalhes
        </button>

        <button
          mat-raised-button
          color="primary"
          [disabled]="product.stock === 0"
          (click)="addToCart(product)"
        >
          <mat-icon>shopping_cart</mat-icon>
          Adicionar
        </button>
      </mat-card-actions>
    </mat-card>
  </div>

  <mat-paginator
    *ngIf="!isLoading && filteredProducts.length > pageSize"
    [length]="totalProducts"
    [pageSize]="pageSize"
    [pageSizeOptions]="[6, 12, 24]"
    [pageIndex]="currentPage"
    (page)="handlePageEvent($event)"
    showFirstLastButtons
    aria-label="Selecione a página de produtos"
    class="products-paginator"
  >
  </mat-paginator>
</div>
